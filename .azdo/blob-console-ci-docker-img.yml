name: 02-04-blob-console-java-ci-docker-img

# trigger:
#   branches:
#     include:
#       - master
#   paths:
#     include:
#       - src/jobs/blob-spring/*

trigger: none
pr: none

variables:
  path: src/jobs/blob-spring/
  imageName: blob-spring
  acr: scACR

pool:
  vmImage: "ubuntu-22.04"
  demands:
    - docker

stages:
  - stage: "BuildImg"
    displayName: "Build Catalog Api Image"
    jobs:
      - job: "Build"
        steps:
          - checkout: self

          - task: Docker@2
            displayName: "Login to ACR"
            inputs:
              command: login
              containerRegistry: $(acr)

          - task: Docker@2
            displayName: "Build and Push Image"
            inputs:
              containerRegistry: $(acr)
              repository: $(imageName)
              command: "buildAndPush"
              dockerfile: "$(path)dockerfile"
              buildContext: $(path)
              tags: |
                $(Build.BuildId)
                latest

          - task: Docker@2
            displayName: "Logout of ACR"
            inputs:
              command: logout
              containerRegistry: $(acr)
